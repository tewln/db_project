Выполнил: Сулименко Максим
# Общее описание
Данная база данных относится к сети магазинов электроники (можно провести сравнение с DNS, Citilink, Online-trade). Она содержит информацию о пользователях и их онлайн-аккаунтах, о заказах этих пользователей, о товарах, которые продаются в сети, о магазинах-складах (нечто между ПВЗ и обычным магазином электроники). 
##
# Концептуальная модель
##
![db_concept drawio](https://github.com/tewln/db_project/blob/main/images/db_concept.drawio.png "Концептуальная модель")
##
# Логическая модель
##
![db_logic drawio](https://github.com/tewln/db_project/blob/main/images/db_logic.drawio.png "Логическая модель")
##
## Описание таблиц и атрибутов
Модель описывает базу данных для сети магазинов компьютерной периферии, ПО и комплектующих. Описываемые сущности: товары, магазины-склады, клиенты.
### Товары
Для описания товаров используется таблица **`db_project.products`**, имеющая трёх наследников: **`db_project.peripherals`**, **`db_project.software`**, **`db_project.components`** (таблицы, в которых хранятся соответственно периферия, ПО, комплектующие; данные таблицы разбиты ввиду разности их атрибутов). Каждая из трёх таблиц имеет атрибут `product_id`, связывающий их с родительской таблицей **`db_project.product`**.

- Таблица **`db.project.products`** содержит атрибуты `id` - номер товара в базе, `product_type` (служит для упрощения поиска всех характеристик о товаре - для упрощения JOIN-ов), характеризующее, к какой надкатегории относится товар (*ПО, компоненты, периферия*), `name` - название позиции, `company` - компания-производитель товара, `price` - цена за единицу товара (цена может быть не указана - например, в случае уникальности товара), `description` - краткое описание товара (может отсутствовать).

- Таблица **`db_project.components`** содержит атрибуты `vendor`, являющееся названием компании-производителя компонентов (*пример - Palit Geforce RTX 4060 DUAL - видеокарта, производителем которой является Palit, однако графический процессор выпускает NVIDIA*; может отсутствовать, если компании совпадают), и `category`, являюееся категорией, к которой относится комплектующая (*процессор, видеокарта, оперативная память и т.д.*).

- Таблица **`db_project.peripherals`** содержит атрибуты `category`, являющееся категорией, к которой относится товар периферии (*наушники, клавиатура, мышь и т.д.*), и `connection_type` - внешний ключ на таблицу **`db_project.interfaces`**.

- Таблица **`db_project.software`** содержит атрибут `license_duration` - длительность лицензии (если не является бессрочной).

- Таблица **`db_project.interfaces`** содержит атрибут `connection_type` - тип интефейса подключения (*USB 2.0 Type A, USB 3.2 Type C, Bluetooth 5.1 и др.*).
### Магазины-склады
Для описания магазинов-складов служит таблица **`db_project.warehouses`**; для разрешения отношения 'многие к многим' и описания товаров, которые перемещаются на склад и лежат на нём, есть две таблицы: **`db_project.warehouse_inventories`** и **`db_project.deliveries`** соответственно.

- Таблица **`db_project.warehouses`** содержит атрибуты `id` - номер магазина в базе, `name` - название магазина-склада, `region` - регион расположения, `start_date` - дата открытия отделения, `close_date` - дата закрытия отделения (в случае, если дата закрытия неизвестна - установлено стандартное значение 5999-12-31).

- Таблица **`db_project.warehouse_inventories`** содержит атрибуты `warehouse_id`, `product_id` - внешние ключи на таблицы **`db_project.warehouses`** и **`db_project.products`** соответственно, `quantity` - число единиц товара.

- Таблица **`db_project.deliveries`** содержит атрибуты `product_id`, `warehouse_id` - внешние ключи на таблицы **`db_project.products`** и **`db_project.warehouses`** соответственно, `delivery_date` - дата доставки на склад, `quantity` - число единиц товара.
### Клиенты
Для описания клиентов служит таблица **`db_project.users`**, а также таблицы **`db_project.users_auth_data`** (содержит данные для аутентификации клиента на сайте) и **`db_project.users_contacts`** (содержит контактные данные клиента).

- Таблица **`db_project.users`** содержит атрибуты `id` - номер клиента в базе, `surname`, `firstname`, `lastname` - ФИО пользователя, `birth_date` - дата рождения пользователя, `region` - регион, выбранный пользователем в качестве домашнего.

- Таблица **`db_project.users_auth_data`** содержит атрибуты `login` и `password` - логин и пароль клиента. `id` в данной таблице одновременно является внешним ключом на таблицу **`db_project.users`** - для поддержания отношения 'один к одному' и выделение аутентификационных данных в отдельных от таблицы пользователей таблицу.

- Таблица **`db_project.users_contacts`** содержит атрибуты `user_id` - внешний ключ на **`db_project.users`** и `phone_number` - номер телефона клиента.
#### Заказы
Являются связью между клиентами и заказанными продуктами. Влияют на склады (изменяют количество товаров на складе региона клиента).

- Таблица **`db_project.orders`** содержит атрибуты `user_id` - внешний ключ на клиента, `created_at` - дата создания заказа, `delivery_date` - дата предолагаемой выдачи заказа, `order_status` - статус заказа (*собирается, в пути, выполнен и др.*)

- Таблица **`db_project.order_lists`** служит для разрешения отношения 'многие к многим' и содержит атрибуты `product_id`, `order_id` - внешние ключи на **`db_project.orders`** и **`db_project.products`** соответсвенно, `quantity` - число единиц данного товара в заказе.

- Таблицы **`db_project.orders_history`** и **`db_project.order_lists_history`** служат для сохранения истории изменения заказов; полностью повторяют атрибуты таблиц **`db_project.orders`** и **`db_project.order_lists`** соответственно, с добавлением атрибута `update_date` - дата изменения заказа.
## Нормальная форма
- В таблицах **`db_project.products`**, **`db_project.users`**, **`db_project.warehouses`** ввиду наличия суррогатного ключа, реализована вторая нормальная форма. В остальных таблицах реализована третья нормальная форма.
- Суррогатный ключ в таблице **`db_propject.products`** применён ввиду отсутствия гарантированного потенциального ключа при масштабировании (пример - товары, привезённые разными партиями, имеют разную цену, при этом название, производитель и тип остаётся одним и тем же, а описание может отсутствовать - т.е. даже ключ `(product_type, name, company, price, description)` не гарантирует уникальности)
- Суррогатный ключ в таблице **`db_project.warehouses`** применём ввиду громоздкости потенциального ключа `(name, region, start_date)`
- Суррогатный ключ в таблице **`db_project.users`** применён ввиду громоздкости потенциального ключа `(surname, firstname, lastname, birth_date)`
## Версионирование
- Таблица **`db_project.products`** поддерживает SCD 1 версионирование: со временем, цены и описания могут меняться, однако нам не важно, каковы эти параметры были до изменения, - в проекте нет функционала, требующего истории цен и/или другой информации о продукте, которая может изменяться, поэтому мы можем перезаписывать значения атрибутов.
- Таблица **`db_project.warehouses`** поддерживает SCD 2 версионирование: записи о существовании закрытых складов не удаляются (ввиду возможной ценности этой информации), поэтому, для разделения действующих и закрывшихся складов введём информацию не только о дате открытия, но и закрытия складов; так, мы сможем хранить все склады без необходимости отделять закрытые склады.
- Таблицы **`db_project.orders_history`** и **`db_project.order_lists_history`** поддерживают SCD 4 версионирование: храним все изменения (с указанием даты, когда это произошло) заказов.
# Физическая модель
## ENUM
Для описания состояний заказа был добавлен тип enum **`ORDER_STATUS`**, состояния: `'selected'`,`'collecting'`, `'underway'`, `'delivered'`, `'recieved'`, `'rejected'`, `'returned'`
## CHECK
Для корректности некоторых полей, были добавлены проверки на неотрицательность для некоторых целочисленных атрибутов, 'непустость' и/или соответствию регулярным выражениям некоторых строковых атрибутов, корректного расположения относительно друг друга дат создания и прекращения деятельности сущностей и текущего времени.
##
![db_physics drawio](https://github.com/tewln/db_project/blob/main/images/db_physics.drawio.png "Физическая модель")
##
